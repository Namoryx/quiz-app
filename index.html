<!DOCTYPE html>
<html lang="ko"><head>

<script class="injected-ffc2e83d85">
(function(){'use strict';function q(b){var c=0;return function(){return c<b.length?{done:!1,value:b[c++]}:{done:!0}}}function t(b){var c=typeof Symbol!="undefined"&&Symbol.iterator&&b[Symbol.iterator];if(c)return c.call(b);if(typeof b.length=="number")return{next:q(b)};throw Error(String(b)+" is not an iterable or ArrayLike");}var u=typeof Object.defineProperties=="function"?Object.defineProperty:function(b,c,g){if(b==Array.prototype||b==Object.prototype)return b;b[c]=g.value;return b};
function v(b){b=["object"==typeof globalThis&&globalThis,b,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var c=0;c<b.length;++c){var g=b[c];if(g&&g.Math==Math)return g}throw Error("Cannot find global object");}var w=v(this);function x(b,c){if(c)a:{var g=w;b=b.split(".");for(var h=0;h<b.length-1;h++){var l=b[h];if(!(l in g))break a;g=g[l]}b=b[b.length-1];h=g[b];c=c(h);c!=h&&c!=null&&u(g,b,{configurable:!0,writable:!0,value:c})}}
function y(){this.j=!1;this.g=null;this.u=void 0;this.h=1;this.v=this.l=0;this.i=null}function z(b){if(b.j)throw new TypeError("Generator is already running");b.j=!0}y.prototype.o=function(b){this.u=b};function A(b,c){b.i={I:c,J:!0};b.h=b.l||b.v}y.prototype.return=function(b){this.i={return:b};this.h=this.v};function B(b){this.g=new y;this.h=b}function E(b,c){z(b.g);var g=b.g.g;if(g)return F(b,"return"in g?g["return"]:function(h){return{value:h,done:!0}},c,b.g.return);b.g.return(c);return G(b)}
function F(b,c,g,h){try{var l=c.call(b.g.g,g);if(!(l instanceof Object))throw new TypeError("Iterator result "+l+" is not an object");if(!l.done)return b.g.j=!1,l;var m=l.value}catch(f){return b.g.g=null,A(b.g,f),G(b)}b.g.g=null;h.call(b.g,m);return G(b)}function G(b){for(;b.g.h;)try{var c=b.h(b.g);if(c)return b.g.j=!1,{value:c.value,done:!1}}catch(g){b.g.u=void 0,A(b.g,g)}b.g.j=!1;if(b.g.i){c=b.g.i;b.g.i=null;if(c.J)throw c.I;return{value:c.return,done:!0}}return{value:void 0,done:!0}}
function H(b){this.next=function(c){z(b.g);b.g.g?c=F(b,b.g.g.next,c,b.g.o):(b.g.o(c),c=G(b));return c};this.throw=function(c){z(b.g);b.g.g?c=F(b,b.g.g["throw"],c,b.g.o):(A(b.g,c),c=G(b));return c};this.return=function(c){return E(b,c)};this[Symbol.iterator]=function(){return this}}function I(b){function c(h){return b.next(h)}function g(h){return b.throw(h)}return new Promise(function(h,l){function m(f){f.done?h(f.value):Promise.resolve(f.value).then(c,g).then(m,l)}m(b.next())})}
x("Symbol",function(b){function c(m){if(this instanceof c)throw new TypeError("Symbol is not a constructor");return new g(h+(m||"")+"_"+l++,m)}function g(m,f){this.g=m;u(this,"description",{configurable:!0,writable:!0,value:f})}if(b)return b;g.prototype.toString=function(){return this.g};var h="jscomp_symbol_"+(Math.random()*1E9>>>0)+"_",l=0;return c});
x("Symbol.iterator",function(b){if(b)return b;b=Symbol("Symbol.iterator");u(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return J(q(this))}});return b});function J(b){b={next:b};b[Symbol.iterator]=function(){return this};return b}
x("Promise",function(b){function c(f){this.h=0;this.i=void 0;this.g=[];this.u=!1;var a=this.j();try{f(a.resolve,a.reject)}catch(d){a.reject(d)}}function g(){this.g=null}function h(f){return f instanceof c?f:new c(function(a){a(f)})}if(b)return b;g.prototype.h=function(f){if(this.g==null){this.g=[];var a=this;this.i(function(){a.l()})}this.g.push(f)};var l=w.setTimeout;g.prototype.i=function(f){l(f,0)};g.prototype.l=function(){for(;this.g&&this.g.length;){var f=this.g;this.g=[];for(var a=0;a<f.length;++a){var d=
f[a];f[a]=null;try{d()}catch(e){this.j(e)}}}this.g=null};g.prototype.j=function(f){this.i(function(){throw f;})};c.prototype.j=function(){function f(e){return function(k){d||(d=!0,e.call(a,k))}}var a=this,d=!1;return{resolve:f(this.D),reject:f(this.l)}};c.prototype.D=function(f){if(f===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(f instanceof c)this.G(f);else{a:switch(typeof f){case "object":var a=f!=null;break a;case "function":a=!0;break a;default:a=!1}a?this.C(f):this.o(f)}};
c.prototype.C=function(f){var a=void 0;try{a=f.then}catch(d){this.l(d);return}typeof a=="function"?this.H(a,f):this.o(f)};c.prototype.l=function(f){this.v(2,f)};c.prototype.o=function(f){this.v(1,f)};c.prototype.v=function(f,a){if(this.h!=0)throw Error("Cannot settle("+f+", "+a+"): Promise already settled in state"+this.h);this.h=f;this.i=a;this.h===2&&this.F();this.K()};c.prototype.F=function(){var f=this;l(function(){if(f.B()){var a=w.console;typeof a!=="undefined"&&a.error(f.i)}},1)};c.prototype.B=
function(){if(this.u)return!1;var f=w.CustomEvent,a=w.Event,d=w.dispatchEvent;if(typeof d==="undefined")return!0;typeof f==="function"?f=new f("unhandledrejection",{cancelable:!0}):typeof a==="function"?f=new a("unhandledrejection",{cancelable:!0}):(f=w.document.createEvent("CustomEvent"),f.initCustomEvent("unhandledrejection",!1,!0,f));f.promise=this;f.reason=this.i;return d(f)};c.prototype.K=function(){if(this.g!=null){for(var f=0;f<this.g.length;++f)m.h(this.g[f]);this.g=null}};var m=new g;c.prototype.G=
function(f){var a=this.j();f.A(a.resolve,a.reject)};c.prototype.H=function(f,a){var d=this.j();try{f.call(a,d.resolve,d.reject)}catch(e){d.reject(e)}};c.prototype.then=function(f,a){function d(n,r){return typeof n=="function"?function(C){try{e(n(C))}catch(D){k(D)}}:r}var e,k,p=new c(function(n,r){e=n;k=r});this.A(d(f,e),d(a,k));return p};c.prototype.catch=function(f){return this.then(void 0,f)};c.prototype.A=function(f,a){function d(){switch(e.h){case 1:f(e.i);break;case 2:a(e.i);break;default:throw Error("Unexpected state: "+
e.h);}}var e=this;this.g==null?m.h(d):this.g.push(d);this.u=!0};c.resolve=h;c.reject=function(f){return new c(function(a,d){d(f)})};c.race=function(f){return new c(function(a,d){for(var e=t(f),k=e.next();!k.done;k=e.next())h(k.value).A(a,d)})};c.all=function(f){var a=t(f),d=a.next();return d.done?h([]):new c(function(e,k){function p(C){return function(D){n[C]=D;r--;r==0&&e(n)}}var n=[],r=0;do n.push(void 0),r++,h(d.value).A(p(n.length-1),k),d=a.next();while(!d.done)})};return c});
function K(b,c){return Object.prototype.hasOwnProperty.call(b,c)}x("Object.is",function(b){return b?b:function(c,g){return c===g?c!==0||1/c===1/g:c!==c&&g!==g}});x("Array.prototype.includes",function(b){return b?b:function(c,g){var h=this;h instanceof String&&(h=String(h));var l=h.length;g=g||0;for(g<0&&(g=Math.max(g+l,0));g<l;g++){var m=h[g];if(m===c||Object.is(m,c))return!0}return!1}});
x("String.prototype.includes",function(b){return b?b:function(c,g){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(c,g||0)!==-1}});
x("WeakMap",function(b){function c(d){this.g=(a+=Math.random()+1).toString();if(d){d=t(d);for(var e;!(e=d.next()).done;)e=e.value,this.set(e[0],e[1])}}function g(){}function h(d){var e=typeof d;return e==="object"&&d!==null||e==="function"}function l(d){if(!K(d,f)){var e=new g;u(d,f,{value:e})}}function m(d){var e=Object[d];e&&(Object[d]=function(k){if(k instanceof g)return k;Object.isExtensible(k)&&l(k);return e(k)})}if(function(){if(!b||!Object.seal)return!1;try{var d=Object.seal({}),e=Object.seal({}),
k=new b([[d,2],[e,3]]);if(k.get(d)!=2||k.get(e)!=3)return!1;k.delete(d);k.set(e,4);return!k.has(d)&&k.get(e)==4}catch(p){return!1}}())return b;var f="$jscomp_hidden_"+Math.random();m("freeze");m("preventExtensions");m("seal");var a=0;c.prototype.set=function(d,e){if(!h(d))throw Error("Invalid WeakMap key");l(d);if(!K(d,f))throw Error("WeakMap key fail: "+d);d[f][this.g]=e;return this};c.prototype.get=function(d){return h(d)&&K(d,f)?d[f][this.g]:void 0};c.prototype.has=function(d){return h(d)&&K(d,
f)&&K(d[f],this.g)};c.prototype.delete=function(d){return h(d)&&K(d,f)&&K(d[f],this.g)?delete d[f][this.g]:!1};return c});
x("Map",function(b){function c(){var a={};return a.m=a.next=a.head=a}function g(a,d){var e=a[1];return J(function(){if(e){for(;e.head!=a[1];)e=e.m;for(;e.next!=e.head;)return e=e.next,{done:!1,value:d(e)};e=null}return{done:!0,value:void 0}})}function h(a,d){var e=d&&typeof d;e=="object"||e=="function"?m.has(d)?e=m.get(d):(e=""+ ++f,m.set(d,e)):e="p_"+d;var k=a[0][e];if(k&&K(a[0],e))for(a=0;a<k.length;a++){var p=k[a];if(d!==d&&p.key!==p.key||d===p.key)return{id:e,list:k,index:a,entry:p}}return{id:e,
list:k,index:-1,entry:void 0}}function l(a){this[0]={};this[1]=c();this.size=0;if(a){a=t(a);for(var d;!(d=a.next()).done;)d=d.value,this.set(d[0],d[1])}}if(function(){if(!b||typeof b!="function"||!b.prototype.entries||typeof Object.seal!="function")return!1;try{var a=Object.seal({x:4}),d=new b(t([[a,"s"]]));if(d.get(a)!="s"||d.size!=1||d.get({x:4})||d.set({x:4},"t")!=d||d.size!=2)return!1;var e=d.entries(),k=e.next();if(k.done||k.value[0]!=a||k.value[1]!="s")return!1;k=e.next();return k.done||k.value[0].x!=
4||k.value[1]!="t"||!e.next().done?!1:!0}catch(p){return!1}}())return b;var m=new WeakMap;l.prototype.set=function(a,d){a=a===0?0:a;var e=h(this,a);e.list||(e.list=this[0][e.id]=[]);e.entry?e.entry.value=d:(e.entry={next:this[1],m:this[1].m,head:this[1],key:a,value:d},e.list.push(e.entry),this[1].m.next=e.entry,this[1].m=e.entry,this.size++);return this};l.prototype.delete=function(a){a=h(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this[0][a.id],a.entry.m.next=a.entry.next,
a.entry.next.m=a.entry.m,a.entry.head=null,this.size--,!0):!1};l.prototype.clear=function(){this[0]={};this[1]=this[1].m=c();this.size=0};l.prototype.has=function(a){return!!h(this,a).entry};l.prototype.get=function(a){return(a=h(this,a).entry)&&a.value};l.prototype.entries=function(){return g(this,function(a){return[a.key,a.value]})};l.prototype.keys=function(){return g(this,function(a){return a.key})};l.prototype.values=function(){return g(this,function(a){return a.value})};l.prototype.forEach=
function(a,d){for(var e=this.entries(),k;!(k=e.next()).done;)k=k.value,a.call(d,k[1],k[0],this)};l.prototype[Symbol.iterator]=l.prototype.entries;var f=0;return l});
x("Set",function(b){function c(g){this.g=new Map;if(g){g=t(g);for(var h;!(h=g.next()).done;)this.add(h.value)}this.size=this.g.size}if(function(){if(!b||typeof b!="function"||!b.prototype.entries||typeof Object.seal!="function")return!1;try{var g=Object.seal({x:4}),h=new b(t([g]));if(!h.has(g)||h.size!=1||h.add(g)!=h||h.size!=1||h.add({x:4})!=h||h.size!=2)return!1;var l=h.entries(),m=l.next();if(m.done||m.value[0]!=g||m.value[1]!=g)return!1;m=l.next();return m.done||m.value[0]==g||m.value[0].x!=4||
m.value[1]!=m.value[0]?!1:l.next().done}catch(f){return!1}}())return b;c.prototype.add=function(g){g=g===0?0:g;this.g.set(g,g);this.size=this.g.size;return this};c.prototype.delete=function(g){g=this.g.delete(g);this.size=this.g.size;return g};c.prototype.clear=function(){this.g.clear();this.size=0};c.prototype.has=function(g){return this.g.has(g)};c.prototype.entries=function(){return this.g.entries()};c.prototype.values=function(){return this.g.values()};c.prototype.keys=c.prototype.values;c.prototype[Symbol.iterator]=
c.prototype.values;c.prototype.forEach=function(g,h){var l=this;this.g.forEach(function(m){return g.call(h,m,m,l)})};return c});(function(){function b(){return m?Promise.resolve(m):f?f:f=fetch("https://www.gstatic.com/bard-maui/resources/material-design-icon-names.804824289.json").then(function(a){if(!a.ok)throw Error("HTTP error! status: "+a.status+" fetching https://www.gstatic.com/bard-maui/resources/material-design-icon-names.804824289.json");return a.json()}).then(function(a){if(!Array.isArray(a))throw new TypeError("Fetched icon names from https://www.gstatic.com/bard-maui/resources/material-design-icon-names.804824289.json is not an array.");
return m=a}).catch(function(a){console.error("IconChecker: Failed to load valid icon names from https://www.gstatic.com/bard-maui/resources/material-design-icon-names.804824289.json.",a);f=null;throw a;})}function c(a){var d,e,k,p;return I(new H(new B(function(n){switch(n.h){case 1:d=(a.textContent||"").trim();if(!d||a.classList.contains("js-replaced-missing-icon")&&d==="radio_button_unchecked")return n.return();e=window.getComputedStyle(a);if(e.display==="none"||e.visibility==="hidden")return n.return();
n.l=2;var r=b();n.h=4;return{value:r};case 4:k=n.u;n.h=3;n.l=0;break;case 2:return n.l=0,n.i=null,console.warn('IconChecker: Skipping check for icon "'+d+'" as valid names could not be loaded.'),n.return();case 3:(p=k.includes(d))?a.classList.contains("js-replaced-missing-icon")&&a.classList.remove("js-replaced-missing-icon"):d==="radio_button_unchecked"&&a.classList.contains("js-replaced-missing-icon")||(a.textContent="radio_button_unchecked",a.classList.add("js-replaced-missing-icon")),n.h=0}})))}
function g(a){a=a===void 0?document.body:a;a.querySelectorAll(l).forEach(function(d){c(d)})}function h(){b().catch(function(){});document.fonts.ready.then(function(){requestAnimationFrame(function(){g(document.body);(new MutationObserver(function(a){var d=new Set;a=t(a);for(var e=a.next();!e.done;e=a.next())if(e=e.value,e.type==="childList")e.addedNodes.forEach(function(p){p.nodeType===Node.ELEMENT_NODE&&(p.matches(l)&&d.add(p),p.querySelectorAll(l).forEach(function(n){d.add(n)}))});else if(e.type===
"attributes"&&e.attributeName==="class"){var k=e.target;e.target.nodeType===Node.ELEMENT_NODE&&k.matches(l)&&d.add(k)}else e.type==="characterData"&&e.target.parentNode&&(e=e.target.parentNode,e.nodeType===Node.ELEMENT_NODE&&e.matches(l)&&d.add(e));d.size>0&&setTimeout(function(){d.forEach(function(p){c(p)})},500)})).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class"],characterData:!0})})}).catch(function(a){console.error("IconChecker: Font loading error. Scanning icons anyway.",
a);requestAnimationFrame(function(){g(document.body)})})}var l=["material-icons","material-symbols-outlined","material-symbols-rounded","material-symbols-sharp"].map(function(a){return"."+a}).join(","),m=null,f=null;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){h()}):h()})();}).call(this);

</script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Databricks Exam Prep</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- SheetJS for Excel Support -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&amp;family=JetBrains+Mono:wght@400;700&amp;display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f1f5f9; }
        .code-block {
            font-family: 'JetBrains Mono', monospace;
            background-color: #1e293b; color: #e2e8f0;
            padding: 1rem; border-radius: 0.5rem;
            white-space: pre-wrap; overflow-x: auto;
            margin: 0.75rem 0; font-size: 0.875rem; line-height: 1.6;
            border: 1px solid #334155;
        }
        .option-card { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .option-card:hover:not(.disabled):not(.selected) {
            border-color: #94a3b8; background-color: #f8fafc; transform: translateY(-1px);
        }
        .option-card.selected {
            border-color: #3b82f6; background-color: #eff6ff; box-shadow: 0 0 0 2px #3b82f6 inset;
        }
        .option-card.correct {
            border-color: #22c55e !important; background-color: #f0fdf4 !important;
            box-shadow: 0 0 0 2px #22c55e inset !important;
        }
        .option-card.wrong {
            border-color: #ef4444 !important; background-color: #fef2f2 !important;
            box-shadow: 0 0 0 2px #ef4444 inset !important;
        }
        .option-card.disabled { cursor: default; opacity: 0.9; }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up { animation: slideUp 0.4s ease-out; }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.pointer-events-none{pointer-events:none}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{inset:0px}.top-0{top:0px}.z-30{z-index:30}.mx-auto{margin-left:auto;margin-right:auto}.mb-1{margin-bottom:0.25rem}.mb-2{margin-bottom:0.5rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mr-2{margin-right:0.5rem}.mt-1{margin-top:0.25rem}.mt-4{margin-top:1rem}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-1{height:0.25rem}.h-10{height:2.5rem}.h-12{height:3rem}.h-16{height:4rem}.h-full{height:100%}.min-h-\[600px\]{min-height:600px}.min-h-screen{min-height:100vh}.w-0{width:0px}.w-10{width:2.5rem}.w-12{width:3rem}.w-16{width:4rem}.w-full{width:100%}.max-w-2xl{max-width:42rem}.max-w-4xl{max-width:56rem}.max-w-5xl{max-width:64rem}.max-w-md{max-width:28rem}.flex-grow{flex-grow:1}.cursor-pointer{cursor:pointer}.grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-end{align-items:flex-end}.items-center{align-items:center}.items-baseline{align-items:baseline}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-1{gap:0.25rem}.gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.overflow-hidden{overflow:hidden}.whitespace-pre-wrap{white-space:pre-wrap}.rounded{border-radius:0.25rem}.rounded-2xl{border-radius:1rem}.rounded-3xl{border-radius:1.5rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}.border{border-width:1px}.border-2{border-width:2px}.border-b{border-bottom-width:1px}.border-t{border-top-width:1px}.border-dashed{border-style:dashed}.border-blue-100{--tw-border-opacity:1;border-color:rgb(219 234 254 / var(--tw-border-opacity, 1))}.border-green-100{--tw-border-opacity:1;border-color:rgb(220 252 231 / var(--tw-border-opacity, 1))}.border-green-200{--tw-border-opacity:1;border-color:rgb(187 247 208 / var(--tw-border-opacity, 1))}.border-red-100{--tw-border-opacity:1;border-color:rgb(254 226 226 / var(--tw-border-opacity, 1))}.border-red-200{--tw-border-opacity:1;border-color:rgb(254 202 202 / var(--tw-border-opacity, 1))}.border-slate-100{--tw-border-opacity:1;border-color:rgb(241 245 249 / var(--tw-border-opacity, 1))}.border-slate-200{--tw-border-opacity:1;border-color:rgb(226 232 240 / var(--tw-border-opacity, 1))}.border-slate-300{--tw-border-opacity:1;border-color:rgb(203 213 225 / var(--tw-border-opacity, 1))}.bg-blue-100{--tw-bg-opacity:1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.bg-blue-50{--tw-bg-opacity:1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-green-50{--tw-bg-opacity:1;background-color:rgb(240 253 244 / var(--tw-bg-opacity, 1))}.bg-indigo-100{--tw-bg-opacity:1;background-color:rgb(224 231 255 / var(--tw-bg-opacity, 1))}.bg-indigo-600{--tw-bg-opacity:1;background-color:rgb(79 70 229 / var(--tw-bg-opacity, 1))}.bg-orange-50{--tw-bg-opacity:1;background-color:rgb(255 247 237 / var(--tw-bg-opacity, 1))}.bg-red-50{--tw-bg-opacity:1;background-color:rgb(254 242 242 / var(--tw-bg-opacity, 1))}.bg-slate-100{--tw-bg-opacity:1;background-color:rgb(241 245 249 / var(--tw-bg-opacity, 1))}.bg-slate-50{--tw-bg-opacity:1;background-color:rgb(248 250 252 / var(--tw-bg-opacity, 1))}.bg-slate-800{--tw-bg-opacity:1;background-color:rgb(30 41 59 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-gradient-to-br{background-image:linear-gradient(to bottom right, var(--tw-gradient-stops))}.bg-gradient-to-r{background-image:linear-gradient(to right, var(--tw-gradient-stops))}.from-blue-500{--tw-gradient-from:#3b82f6 var(--tw-gradient-from-position);--tw-gradient-to:rgb(59 130 246 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-slate-700{--tw-gradient-from:#334155 var(--tw-gradient-from-position);--tw-gradient-to:rgb(51 65 85 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.to-indigo-600{--tw-gradient-to:#4f46e5 var(--tw-gradient-to-position)}.to-slate-900{--tw-gradient-to:#0f172a var(--tw-gradient-to-position)}.p-10{padding:2.5rem}.p-2{padding:0.5rem}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-2{padding-left:0.5rem;padding-right:0.5rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-1{padding-top:0.25rem;padding-bottom:0.25rem}.py-10{padding-top:2.5rem;padding-bottom:2.5rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-2\.5{padding-top:0.625rem;padding-bottom:0.625rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-8{padding-top:2rem;padding-bottom:2rem}.pb-8{padding-bottom:2rem}.text-left{text-align:left}.text-center{text-align:center}.font-mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-6xl{font-size:3.75rem;line-height:1}.text-\[10px\]{font-size:10px}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-black{font-weight:900}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.font-medium{font-weight:500}.uppercase{text-transform:uppercase}.tabular-nums{--tw-numeric-spacing:tabular-nums;font-variant-numeric:var(--tw-ordinal) var(--tw-slashed-zero) var(--tw-numeric-figure) var(--tw-numeric-spacing) var(--tw-numeric-fraction)}.leading-none{line-height:1}.leading-relaxed{line-height:1.625}.leading-tight{line-height:1.25}.tracking-wider{letter-spacing:0.05em}.text-blue-500{--tw-text-opacity:1;color:rgb(59 130 246 / var(--tw-text-opacity, 1))}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-blue-800{--tw-text-opacity:1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.text-blue-900{--tw-text-opacity:1;color:rgb(30 58 138 / var(--tw-text-opacity, 1))}.text-green-600{--tw-text-opacity:1;color:rgb(22 163 74 / var(--tw-text-opacity, 1))}.text-green-700{--tw-text-opacity:1;color:rgb(21 128 61 / var(--tw-text-opacity, 1))}.text-indigo-600{--tw-text-opacity:1;color:rgb(79 70 229 / var(--tw-text-opacity, 1))}.text-orange-500{--tw-text-opacity:1;color:rgb(249 115 22 / var(--tw-text-opacity, 1))}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.text-red-600{--tw-text-opacity:1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.text-red-700{--tw-text-opacity:1;color:rgb(185 28 28 / var(--tw-text-opacity, 1))}.text-slate-400{--tw-text-opacity:1;color:rgb(148 163 184 / var(--tw-text-opacity, 1))}.text-slate-500{--tw-text-opacity:1;color:rgb(100 116 139 / var(--tw-text-opacity, 1))}.text-slate-600{--tw-text-opacity:1;color:rgb(71 85 105 / var(--tw-text-opacity, 1))}.text-slate-700{--tw-text-opacity:1;color:rgb(51 65 85 / var(--tw-text-opacity, 1))}.text-slate-800{--tw-text-opacity:1;color:rgb(30 41 59 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.underline{-webkit-text-decoration-line:underline;text-decoration-line:underline}.opacity-0{opacity:0}.opacity-50{opacity:0.5}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-blue-200{--tw-shadow-color:#bfdbfe;--tw-shadow:var(--tw-shadow-colored)}.transition{transition-property:color, background-color, border-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-300{transition-duration:300ms}.duration-500{transition-duration:500ms}.ease-out{transition-timing-function:cubic-bezier(0, 0, 0.2, 1)}.hover\:-translate-y-0\.5:hover{--tw-translate-y:-0.125rem;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:border-blue-400:hover{--tw-border-opacity:1;border-color:rgb(96 165 250 / var(--tw-border-opacity, 1))}.hover\:border-blue-500:hover{--tw-border-opacity:1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.hover\:border-orange-500:hover{--tw-border-opacity:1;border-color:rgb(249 115 22 / var(--tw-border-opacity, 1))}.hover\:bg-blue-50:hover{--tw-bg-opacity:1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.hover\:bg-indigo-700:hover{--tw-bg-opacity:1;background-color:rgb(67 56 202 / var(--tw-bg-opacity, 1))}.hover\:bg-slate-50:hover{--tw-bg-opacity:1;background-color:rgb(248 250 252 / var(--tw-bg-opacity, 1))}.hover\:bg-slate-900:hover{--tw-bg-opacity:1;background-color:rgb(15 23 42 / var(--tw-bg-opacity, 1))}.hover\:bg-white:hover{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.hover\:text-blue-600:hover{--tw-text-opacity:1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.hover\:text-slate-600:hover{--tw-text-opacity:1;color:rgb(71 85 105 / var(--tw-text-opacity, 1))}.hover\:shadow-md:hover{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.hover\:shadow-sm:hover{--tw-shadow:0 1px 2px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.active\:scale-95:active{--tw-scale-x:.95;--tw-scale-y:.95;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.disabled\:opacity-50:disabled{opacity:0.5}.group:hover .group-hover\:scale-105{--tw-scale-x:1.05;--tw-scale-y:1.05;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.group:hover .group-hover\:scale-110{--tw-scale-x:1.1;--tw-scale-y:1.1;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@media (min-width: 640px){.sm\:flex{display:flex}.sm\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.sm\:p-10{padding:2.5rem}.sm\:p-6{padding:1.5rem}.sm\:p-8{padding:2rem}}@media (min-width: 768px){.md\:flex{display:flex}}</style></head>
<body class="min-h-screen text-slate-800 flex flex-col">

<!-- Header -->
<header class="bg-white border-b border-slate-200 sticky top-0 z-30 shadow-sm">
    <div class="max-w-5xl mx-auto px-4 py-3 flex justify-between items-center">
        <!-- Logo / Reset -->
        <div class="flex items-center gap-3 cursor-pointer group" onclick="window.app.goHome()">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-slate-700 to-slate-900 flex items-center justify-center text-white shadow-md group-hover:scale-105 transition-transform">
                <span class="material-symbols-outlined text-2xl">school</span>
            </div>
            <div>
                <h1 class="font-bold text-slate-800 leading-tight text-lg">Exam Prep</h1>
                <p class="text-xs text-slate-500 font-medium">Databricks Data Engineer</p>
            </div>
        </div>

        <div class="flex items-center gap-3">
            <!-- Status Indicators -->
            <div class="hidden md:flex flex-col items-end mr-2" id="status-display">
                <span class="text-[10px] text-slate-400 uppercase font-bold tracking-wider" id="status-label">Ready</span>
                <span class="font-mono font-bold text-lg text-slate-700 tabular-nums leading-none" id="status-value">--:--</span>
            </div>
            
            <!-- Home Button -->
            <button class="bg-white border border-slate-200 text-slate-600 p-2 rounded-lg hover:bg-slate-50 transition shadow-sm hover:text-blue-600" onclick="window.app.goHome()" title="홈으로">
                <span class="material-symbols-outlined">home</span>
            </button>

            <!-- Save App Button -->
            <button class="text-xs font-bold bg-white border border-slate-300 text-slate-600 px-3 py-2 rounded-lg hover:bg-slate-50 transition shadow-sm flex items-center gap-1 hidden sm:flex" onclick="window.app.downloadApp()">
                <span class="material-symbols-outlined text-base">download</span>
                <span>앱 저장</span>
            </button>
        </div>
    </div>
    <div class="h-1 w-full bg-slate-100 overflow-hidden">
        <div class="h-full bg-gradient-to-r from-blue-500 to-indigo-600 transition-all duration-500 ease-out w-0" id="progress-bar"></div>
    </div>
</header>

<main class="flex-grow p-4 sm:p-6 w-full max-w-5xl mx-auto flex flex-col relative min-h-[600px]">
    
    <!-- SCREEN: START & UPLOAD -->
    <div class="flex-grow flex flex-col items-center justify-center animate-slide-up py-8" id="view-start">
        <div class="bg-white p-8 sm:p-10 rounded-3xl shadow-xl border border-slate-100 max-w-2xl w-full relative overflow-hidden">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-extrabold text-slate-800 mb-2">시험 준비</h2>
                <p class="text-slate-500">Excel(.xlsx) 또는 CSV 파일을 업로드하여 학습을 시작하세요.</p>
            </div>

            <!-- File Upload Zone -->
            <div class="mb-8">
                <div class="border-2 border-dashed border-slate-300 rounded-2xl p-8 text-center hover:border-blue-400 hover:bg-blue-50 transition-colors cursor-pointer relative group" id="drop-zone">
                    <input type="file" id="file-input" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" accept=".csv, .xlsx, .xls" onchange="window.app.handleFile(this)">
                    <div class="flex flex-col items-center gap-2 pointer-events-none">
                        <div class="w-12 h-12 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mb-2 group-hover:scale-110 transition-transform">
                            <span class="material-symbols-outlined text-2xl">upload_file</span>
                        </div>
                        <p class="font-bold text-slate-700">문제 파일 드래그 또는 클릭</p>
                        <p class="text-xs text-slate-400">지원 형식: .xlsx, .xls, .csv</p>
                    </div>
                </div>
                <div class="mt-4 flex justify-center">
                    <button class="text-xs text-slate-400 hover:text-slate-600 underline" onclick="window.app.loadDefaultData()">
                        샘플 데이터 로드하기
                    </button>
                </div>

                <!-- Data Status Feedback -->
                <div id="data-status" class="hidden mt-4 p-3 rounded-lg bg-green-50 border border-green-200 flex items-center justify-center gap-2 text-sm text-green-700 animate-slide-up">
                    <span class="material-symbols-outlined text-base">check_circle</span>
                    <span id="data-status-text">데이터 로드 완료</span>
                </div>
                <div id="error-status" class="hidden mt-4 p-3 rounded-lg bg-red-50 border border-red-200 flex items-center justify-center gap-2 text-sm text-red-700 animate-slide-up">
                    <span class="material-symbols-outlined text-base">error</span>
                    <span id="error-status-text">오류 발생</span>
                </div>
            </div>

            <!-- Mode Selection (Disabled initially) -->
            <div id="mode-selection" class="grid sm:grid-cols-2 gap-4 opacity-50 pointer-events-none transition-opacity duration-300">
                <button class="group p-5 border-2 border-slate-100 rounded-2xl hover:border-blue-500 hover:shadow-md bg-white text-left transition-all" onclick="window.app.startPractice()">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="material-symbols-outlined text-blue-500 bg-blue-50 p-2 rounded-lg">fitness_center</span>
                        <span class="font-bold text-slate-800">학습 모드</span>
                    </div>
                    <p class="text-xs text-slate-500">10문제씩 끊어서 진행. 보기 순서 랜덤. 오답 무한 반복.</p>
                </button>
                <button class="group p-5 border-2 border-slate-100 rounded-2xl hover:border-orange-500 hover:shadow-md bg-white text-left transition-all" onclick="window.app.startExam()">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="material-symbols-outlined text-orange-500 bg-orange-50 p-2 rounded-lg">timer</span>
                        <span class="font-bold text-slate-800">시험 모드</span>
                    </div>
                    <p class="text-xs text-slate-500">랜덤 60문제. 시간 제한(120분). 최종 점수 확인.</p>
                </button>
            </div>
        </div>
    </div>

    <!-- SCREEN: QUIZ -->
    <div id="view-quiz" class="hidden flex-col gap-6 animate-slide-up max-w-4xl mx-auto w-full">
        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-6 sm:p-8">
                <!-- Question Header -->
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center gap-3">
                        <span class="bg-slate-800 text-white text-xs font-bold px-3 py-1 rounded-full">
                            Question <span id="q-seq">1</span>
                        </span>
                        <span class="text-[10px] text-slate-400 font-mono px-2 py-1 bg-slate-50 rounded">ID: <span id="q-id">101</span></span>
                    </div>
                </div>
                
                <!-- Question Body -->
                <div class="text-lg text-slate-800 font-medium leading-relaxed whitespace-pre-wrap mb-8" id="q-text"></div>

                <!-- Options -->
                <div class="grid gap-3" id="options-container">
                    <!-- Options injected here -->
                </div>
            </div>

            <!-- Explanation Box (Hidden by default) -->
            <div id="explanation-area" class="hidden bg-blue-50 border-t border-blue-100 p-6 sm:p-8">
                <div class="flex gap-3">
                    <span class="material-symbols-outlined text-blue-600 mt-1">lightbulb</span>
                    <div>
                        <h4 class="font-bold text-blue-900 mb-1">정답: <span class="text-lg" id="exp-correct-char">A</span></h4>
                        <div class="text-sm text-blue-800 leading-relaxed whitespace-pre-wrap" id="exp-text"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="flex justify-between items-center pb-8">
            <button id="btn-prev" class="px-5 py-2.5 rounded-xl text-slate-500 hover:bg-white hover:shadow-sm transition font-medium disabled:opacity-50" onclick="window.app.prevQuestion()">
                이전
            </button>
            <div class="flex gap-3">
                <button id="btn-check" class="hidden px-8 py-3 bg-blue-600 text-white rounded-xl font-bold shadow-lg shadow-blue-200 hover:bg-blue-700 hover:-translate-y-0.5 transition active:scale-95">
                    정답 확인
                </button>
                <button id="btn-next" class="hidden px-8 py-3 bg-slate-800 text-white rounded-xl font-bold shadow-lg hover:bg-slate-900 hover:-translate-y-0.5 transition active:scale-95 flex items-center gap-2" onclick="window.app.nextQuestion()">
                    <span>다음</span> <span class="material-symbols-outlined text-sm">arrow_forward</span>
                </button>
            </div>
        </div>
    </div>

    <!-- SCREEN: BATCH SUMMARY -->
    <div id="view-summary" class="hidden flex-grow flex-col items-center justify-center animate-slide-up text-center">
        <div class="bg-white p-8 rounded-3xl shadow-xl border border-slate-200 max-w-2xl w-full">
            <div id="summary-icon" class="w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="material-symbols-outlined text-3xl">refresh</span>
            </div>
            <h2 id="summary-title" class="text-2xl font-bold text-slate-800 mb-2">세트 완료</h2>
            <p id="summary-detail" class="text-slate-600 mb-4">
                이번 세트 오답: <span id="summary-wrong-count" class="font-bold text-red-500">0</span>개<br>
                <span class="text-xs text-slate-400">틀린 문제는 다음 세트에 자동으로 포함됩니다.</span>
            </p>

            <div id="summary-progress-wrap" class="mb-6 text-left space-y-2">
                <div id="summary-progress-text" class="text-sm font-semibold text-slate-700">전체 진행 0/0 (0%)</div>
                <div class="w-full h-2 rounded-full bg-slate-100 overflow-hidden">
                    <div id="summary-progress-bar" class="h-2 bg-indigo-500 rounded-full transition-all" style="width: 0%"></div>
                </div>
            </div>

            <div id="summary-stats" class="mb-6 space-y-4 text-left">
                <div class="grid sm:grid-cols-3 gap-3">
                    <div class="p-4 rounded-2xl border border-slate-100 bg-slate-50">
                        <div class="text-xs font-bold text-slate-500 uppercase">정확도</div>
                        <div id="summary-accuracy" class="text-2xl font-extrabold text-slate-800">0/0 (0%)</div>
                    </div>
                    <div class="p-4 rounded-2xl border border-green-100 bg-green-50">
                        <div class="text-xs font-bold text-green-600 uppercase">정답</div>
                        <div id="summary-correct" class="text-2xl font-extrabold text-green-700">0</div>
                    </div>
                    <div class="p-4 rounded-2xl border border-red-100 bg-red-50">
                        <div class="text-xs font-bold text-red-600 uppercase">오답</div>
                        <div id="summary-wrong" class="text-2xl font-extrabold text-red-700">0</div>
                    </div>
                </div>

                <div class="bg-slate-50 border border-slate-100 rounded-2xl p-6 sm:p-7 max-h-[70vh] overflow-y-auto">
                    <div class="flex items-center gap-2 mb-5 text-lg font-extrabold text-slate-800">
                        <span class="material-symbols-outlined text-base">table</span>
                        이번 세트 오답 기록
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-left text-base sm:text-lg">
                            <thead class="text-slate-700 uppercase font-bold border-b border-slate-200 text-sm sm:text-base">
                                <tr>
                                    <th class="py-3 pr-4">문제</th>
                                    <th class="py-3 px-4">정답</th>
                                    <th class="py-3 pl-4">해설</th>
                                </tr>
                            </thead>
                            <tbody id="summary-table-body" class="divide-y divide-slate-100"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="flex flex-col gap-3">
                <button id="summary-primary" class="w-full py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition shadow-lg" onclick="window.app.nextBatch()">
                    다음 세트 시작
                </button>
                <button id="summary-home" class="hidden w-full py-3 bg-slate-800 text-white rounded-xl font-bold hover:bg-slate-900 transition shadow" onclick="window.app.goHome()">
                    홈으로
                </button>
            </div>
        </div>
    </div>

    <!-- SCREEN: EXAM RESULT -->
    <div id="view-result" class="hidden flex-grow flex-col items-center justify-center animate-slide-up py-10">
        <div class="bg-white p-10 rounded-3xl shadow-2xl border border-slate-100 max-w-2xl w-full text-center">
            <div class="mb-6" id="res-icon"></div>
            <h2 class="text-3xl font-extrabold text-slate-800 mb-2">시험 종료</h2>
            <div class="flex justify-center items-baseline gap-2 mb-8">
                <span id="res-score" class="text-6xl font-black text-slate-800">0</span>
                <span class="text-xl text-slate-400 font-bold">/ 100</span>
            </div>
            
            <div class="grid grid-cols-3 gap-4 mb-8">
                <div class="bg-green-50 p-4 rounded-2xl border border-green-100">
                    <div class="text-xs font-bold text-green-600 uppercase">Correct</div>
                    <div id="res-correct" class="text-2xl font-bold text-green-700">0</div>
                </div>
                <div class="bg-red-50 p-4 rounded-2xl border border-red-100">
                    <div class="text-xs font-bold text-red-600 uppercase">Wrong</div>
                    <div id="res-wrong" class="text-2xl font-bold text-red-700">0</div>
                </div>
                <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100">
                    <div class="text-xs font-bold text-slate-500 uppercase">Total</div>
                    <div id="res-total" class="text-2xl font-bold text-slate-700">0</div>
                </div>
            </div>

            <div class="flex gap-3 justify-center">
                <button class="px-6 py-3 bg-white border border-slate-300 rounded-xl font-bold hover:bg-slate-50 text-slate-600" onclick="window.app.goHome()">
                    홈으로
                </button>
                <button id="btn-review" class="hidden px-6 py-3 bg-slate-800 text-white rounded-xl font-bold hover:bg-slate-900 shadow-lg" onclick="window.app.reviewMode()">
                    오답 노트 확인
                </button>
            </div>
        </div>
    </div>

</main>

<!-- RAW DATA STORE (Default Sample) -->
<script id="raw-data-store" type="text/csv">Question Number,Question Text,Option 1,Option 2,Option 3,Option 4,Option 5,Correct Answer,Answer explanation
1,"상류(upstream) 시스템이 특정 데이터 배치(batch)의 날짜(date)를 Databricks Jobs API 파라미터로 전달하도록 구성되어 있다. 스케줄링될 노트북은 이 파라미터를 사용해 다음 코드로 데이터를 읽는다:

df = spark.read.format(""parquet"").load(f""/mnt/source/{date}"")

위 코드에서 사용하는 Python 변수 date를 생성하는 방법으로 가장 알맞은 코드는 무엇인가?","A. date = spark.conf.get(""date"")","B. input_dict = input()
   date = input_dict[""date""]","C. import sys
   date = sys.argv[1]","D. date = dbutils.notebooks.getParam(""date"")","E. dbutils.widgets.text(""date"", ""null"")
   date = dbutils.widgets.get(""date"")",5,
2,"Databricks 워크스페이스 관리자는 각 데이터 엔지니어링 그룹마다 인터랙티브 클러스터(interactive cluster)를 하나씩 만들어 두었다. 비용을 제어하기 위해, 클러스터는 30분 동안 활동이 없으면 자동으로 종료되도록 설정되어 있다. 각 사용자는 하루 중 언제든지 자신에게 할당된 클러스터에서 워크로드를 실행할 수 있어야 한다.

사용자들은 워크스페이스에 추가만 되어 있고, 아직 어떤 권한도 부여되지 않았다고 가정한다. 이미 존재하는 클러스터를 시작(start)하고 그 클러스터에 붙어서(attach) 작업을 실행하기 위해 한 사용자가 가져야 하는 최소 권한 조합은 무엇인가?","A. 해당 클러스터에 대한 ""Can Manage"" 권한","B. 워크스페이스 관리자(Workspace Admin) 권한, 클러스터 생성 허용, 해당 클러스터에 대한 ""Can Attach To"" 권한","C. 클러스터 생성 허용, 해당 클러스터에 대한 ""Can Attach To"" 권한","D. 해당 클러스터에 대한 ""Can Restart"" 권한","E. 클러스터 생성 허용, 해당 클러스터에 대한 ""Can Restart"" 권한",4,</script>

<script>
/**
 * Unified CSV Parser (supporting EUC-KR) and Excel Handler (via SheetJS)
 */
const DataHandler = {
    sheetJsReady: null,
    // Reads file as ArrayBuffer, detects encoding for CSV or uses SheetJS for Excel
    readFile: function(file) {
        return new Promise((resolve, reject) => {
            const fileName = file.name.toLowerCase();
            const reader = new FileReader();

            reader.onload = (e) => {
                const data = e.target.result;

                if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
                    this.ensureSheetJS()
                        .then(() => this.parseExcel(data))
                        .then(resolve)
                        .catch(reject);
                } else {
                    this.parseCSV(data).then(resolve).catch(reject);
                }
            };
            
            reader.onerror = () => reject(new Error("파일 읽기 실패"));
            reader.readAsArrayBuffer(file);
        });
    },

    ensureSheetJS: function() {
        if (typeof XLSX !== 'undefined') return Promise.resolve();
        if (this.sheetJsReady) return this.sheetJsReady;

        this.sheetJsReady = Promise.reject(new Error('Excel 라이브러리를 불러올 수 없습니다. 새로고침 후 다시 시도하세요.'));
        return this.sheetJsReady;
    },

    parseExcel: function(arrayBuffer) {
        return new Promise((resolve, reject) => {
            try {
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                // Convert to array of arrays (header: 1)
                const rows = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                resolve(rows);
            } catch (e) {
                reject(new Error("Excel 파일 파싱 실패: " + e.message));
            }
        });
    },

    parseCSV: function(arrayBuffer) {
        return new Promise((resolve) => {
            // Detect Encoding (Basic heuristic: if UTF-8 decode fails, try EUC-KR)
            let decoder = new TextDecoder('utf-8', { fatal: true });
            let text;
            try {
                text = decoder.decode(arrayBuffer);
            } catch (e) {
                // Fallback to EUC-KR
                decoder = new TextDecoder('euc-kr');
                text = decoder.decode(arrayBuffer);
            }

            // Parse CSV Text
            const rows = this.parseCSVText(text);
            resolve(rows);
        });
    },

    // Manual CSV Parser for robustness against embedded commas/newlines in quotes
    parseCSVText: function(text) {
        text = text.replace(/^\uFEFF/, '').replace(/\r\n/g, '\n').replace(/\r/g, '\n');
        
        // Detect delimiter
        const firstLine = text.split('\n')[0];
        const delimiter = (firstLine.split('\t').length > firstLine.split(',').length) ? '\t' : ',';

        const rows = [];
        let currentRow = [];
        let currentField = '';
        let inQuotes = false;
        
        for (let i = 0; i < text.length; i++) {
            const char = text[i];
            const next = text[i + 1];

            if (inQuotes) {
                if (char === '"' && next === '"') {
                    currentField += '"'; i++;
                } else if (char === '"') {
                    inQuotes = false;
                } else {
                    currentField += char;
                }
            } else {
                if (char === '"') {
                    inQuotes = true;
                } else if (char === delimiter) {
                    currentRow.push(currentField.trim());
                    currentField = '';
                } else if (char === '\n') {
                    currentRow.push(currentField.trim());
                    if (currentRow.length > 0) rows.push(currentRow);
                    currentRow = [];
                    currentField = '';
                } else {
                    currentField += char;
                }
            }
        }
        if (currentField || currentRow.length > 0) {
            currentRow.push(currentField.trim());
            rows.push(currentRow);
        }
        return rows;
    }
};

const app = {
    db: [],
    session: [],
    mode: 'idle',
    qIdx: 0,
    answers: {},
    weakQueue: [],
    batchWrongIds: [],
    currentSession: [],
    currentSessionPos: 0,
    SESSION_SIZE: 10,
    currentIndex: 0,
    seenQuestions: new Set(),
    totalSeen: 0,
    awaitingWrongContinue: false,
    lastAnsweredIndex: null,
    pendingWrongAckId: null,
    timer: null,
    timeLeft: 0,
    autoAdvanceTimer: null,
    lastSummaryData: null,

    init: function() {
        this.attachUploadHandlers();
    },

    attachUploadHandlers: function() {
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        if(!dropZone || !fileInput) return;

        const highlight = () => dropZone.classList.add('ring-2', 'ring-blue-200', 'bg-blue-50');
        const unhighlight = () => dropZone.classList.remove('ring-2', 'ring-blue-200', 'bg-blue-50');

        ['dragenter', 'dragover'].forEach(evt => {
            dropZone.addEventListener(evt, (e) => {
                e.preventDefault();
                e.stopPropagation();
                if (e.dataTransfer) e.dataTransfer.dropEffect = 'copy';
                highlight();
            });
        });
        ['dragleave', 'drop'].forEach(evt => {
            dropZone.addEventListener(evt, (e) => {
                e.preventDefault();
                e.stopPropagation();
                unhighlight();
            });
        });

        dropZone.addEventListener('drop', (e) => {
            const file = e.dataTransfer?.files && e.dataTransfer.files[0];
            if(file) {
                this.handleFile(file);
            }
        });

        dropZone.addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', (e) => {
            if(e.target?.files?.length) {
                this.handleFile(e.target);
            }
        });

        const blockWindowDrop = (e) => {
            if(!dropZone.contains(e.target)) {
                e.preventDefault();
                e.stopPropagation();
            }
        };
        window.addEventListener('dragover', blockWindowDrop);
        window.addEventListener('drop', blockWindowDrop);
    },

    handleFile: function(inputOrFile) {
        const file = inputOrFile instanceof File ? inputOrFile : (inputOrFile?.files ? inputOrFile.files[0] : null);
        if(!file) return;

        DataHandler.readFile(file)
            .then(rows => this.processRows(rows, file.name))
            .catch(e => this.showError(e.message))
            .finally(() => {
                if(inputOrFile && !(inputOrFile instanceof File)) inputOrFile.value = '';
            });
    },

    loadDefaultData: function() {
        const el = document.getElementById('raw-data-store');
        // Convert string to array buffer to simulate file read for consistency
        const enc = new TextEncoder();
        const buf = enc.encode(el.textContent);
        
        DataHandler.parseCSV(buf).then(rows => {
            this.processRows(rows, "샘플 데이터");
        });
    },

    processRows: function(rows, sourceName) {
        try {
            const headers = (rows[0] || []).map(h => String(h ?? '').trim());
            const normalized = headers.map(h => h.toLowerCase().replace(/\s+/g, ' '));
            const required = [
                'question number',
                'question text',
                'option 1',
                'option 2',
                'option 3',
                'option 4',
                'option 5',
                'correct answer',
                'answer explanation'
            ];

            const headerMatches = required.every((h, idx) => normalized[idx] === h);
            if (!headerMatches) {
                throw new Error('헤더 형식이 올바르지 않습니다. "Question Number, Question Text, Option 1~5, Correct Answer, Answer explanation" 순서로 업로드하세요.');
            }

            const colMap = { id: 0, text: 1, options: [2,3,4,5,6], correct: 7, exp: 8 };
            this.db = [];

            for(let i = 1; i < rows.length; i++) {
                const row = rows[i];
                if(!row || row.length < 3) continue;

                const opts = [];
                colMap.options.forEach(idx => {
                    const val = row[idx];
                    if(val !== undefined && val !== null && String(val).trim() !== '') {
                        opts.push(String(val).trim());
                    }
                });

                let correctVal = row[colMap.correct];
                let correctIdx = -1;

                if (correctVal !== undefined && correctVal !== null) {
                    correctVal = String(correctVal).trim();
                    if(!isNaN(parseInt(correctVal))) {
                        correctIdx = parseInt(correctVal, 10) - 1;
                    } else {
                        const charCode = correctVal.toUpperCase().charCodeAt(0);
                        if(charCode >= 65 && charCode <= 69) correctIdx = charCode - 65;
                    }
                }

                const optionObjects = opts.map((txt, idx) => ({
                    text: txt,
                    isCorrect: idx === correctIdx
                }));

                if(optionObjects.length > 0) {
                    this.db.push({
                        id: row[colMap.id] || (i),
                        text: row[colMap.text],
                        options: optionObjects,
                        explanation: row[colMap.exp] || "해설 없음",
                        meta: {
                            correct_count: 0,
                            wrong_count: 0,
                            mastered: false
                        }
                    });
                }
            }

            if(this.db.length === 0) throw new Error("유효한 문제를 찾을 수 없습니다.");

            document.getElementById('data-status').classList.remove('hidden');
            document.getElementById('data-status').classList.add('flex');
            document.getElementById('data-status-text').innerText = `${sourceName} 로드 완료 (${this.db.length}문제)`;
            document.getElementById('error-status').classList.add('hidden');
            document.getElementById('mode-selection').classList.remove('opacity-50', 'pointer-events-none');

        } catch(e) {
            this.showError(e.message);
        }
    },

    showError: function(msg) {
        console.error(msg);
        document.getElementById('error-status').classList.remove('hidden');
        document.getElementById('error-status').classList.add('flex');
        document.getElementById('error-status-text').innerText = "오류: " + msg;
    },

    // --- NAVIGATION ---

    goHome: function() {
        if(this.mode !== 'idle' && !confirm("현재 진행 중인 학습이 초기화됩니다. 홈으로 이동하시겠습니까?")) return;

        // Reset state but keep DB
        this.mode = 'idle';
        this.session = [];
        this.answers = {};
        this.pendingWrongAckId = null;
        this.awaitingWrongContinue = false;
        this.currentSession = [];
        this.currentSessionPos = 0;
        this.currentIndex = 0;
        this.seenQuestions = new Set();
        this.totalSeen = 0;
        this.weakQueue = [];
        if(this.autoAdvanceTimer) clearTimeout(this.autoAdvanceTimer);
        if(this.timer) clearInterval(this.timer);
        
        this.setView('view-start');
        document.getElementById('status-display').classList.add('hidden');
    },

    downloadApp: function() {
        const html = document.documentElement.outerHTML;
        const blob = new Blob(['<!DOCTYPE html>\n' + html], {type: 'text/html'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'Databricks_Exam_Prep_App.html';
        a.click();
    },

    // --- GAME LOGIC ---

    buildSessionQuestions: function() {
        const session = [];

        const weakCandidates = this.shuffle(this.weakQueue.filter(qIndex => !this.db[qIndex].meta.mastered));
        for (const qIndex of weakCandidates) {
            if (session.length >= this.SESSION_SIZE) break;
            session.push(qIndex);
        }

        const pool = [];
        this.db.forEach((q, idx) => {
            if (!q.meta.mastered && !session.includes(idx)) {
                pool.push(idx);
            }
        });

        const shuffledPool = this.shuffle(pool);
        for (const qIndex of shuffledPool) {
            if (session.length >= this.SESSION_SIZE) break;
            session.push(qIndex);
        }

        this.currentSession = session;
        this.currentSessionPos = 0;
        return session.length > 0;
    },

    shuffle: function(array) {
        const newArr = [...array];
        for (let i = newArr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
        }
        return newArr;
    },

    trimText: function(text = '', limit = 120) {
        if(!text) return '';
        return text.length > limit ? text.slice(0, limit) + '…' : text;
    },

    prepareQuestion: function(qBase, sourceIndex = null) {
        // Shuffle options for this session instance
        const opts = this.shuffle(qBase.options.map(o => ({...o})));
        return {
            ...qBase,
            sourceIndex: sourceIndex,
            options: opts,
            userAnswer: null,
            checked: false
        };
    },

    markWrong: function(qIndex) {
        const meta = this.db[qIndex].meta;
        meta.wrong_count++;
        if (!this.weakQueue.includes(qIndex)) this.weakQueue.push(qIndex);
    },

    markCorrect: function(qIndex) {
        const meta = this.db[qIndex].meta;
        meta.correct_count++;
        meta.mastered = true;
        this.weakQueue = this.weakQueue.filter(idx => idx !== qIndex);
    },

    handleOptionSelect: function(idx) {
        const q = this.session[this.currentSessionPos];
        if(q.checked && this.mode === 'practice') return;

        q.userAnswer = idx;
        this.lastAnsweredIndex = this.currentSessionPos;

        const qIndex = this.currentSession[this.currentSessionPos];
        if(!this.seenQuestions.has(qIndex)) {
            this.seenQuestions.add(qIndex);
            this.totalSeen = this.seenQuestions.size;
        }

        if(this.mode === 'practice') {
            q.checked = true;
            const isCorrect = q.options[idx].isCorrect;
            const wasAwaiting = this.awaitingWrongContinue;
            this.awaitingWrongContinue = false;
            this.pendingWrongAckId = null;

            if(!isCorrect) {
                this.batchWrongIds.push(qIndex);
                this.markWrong(qIndex);
                this.awaitingWrongContinue = true;
                this.pendingWrongAckId = qIndex;
                if(this.autoAdvanceTimer) clearTimeout(this.autoAdvanceTimer);
            } else {
                this.markCorrect(qIndex);
                if(wasAwaiting) this.advanceToNextQuestion();
                else this.scheduleAutoAdvance(qIndex);
            }
        }

        this.renderQuestion();
    },

    scheduleAutoAdvance: function(questionId) {
        if(this.mode !== 'practice') return;
        if(this.autoAdvanceTimer) clearTimeout(this.autoAdvanceTimer);

        const isLast = (this.currentSessionPos === this.session.length - 1);
        this.autoAdvanceTimer = setTimeout(() => {
            const current = this.currentSession[this.currentSessionPos];
            if(current === undefined || current !== questionId) return;
            if(this.pendingWrongAckId === questionId || this.awaitingWrongContinue) return;

            if(isLast) {
                this.showMidSummary();
            } else {
                this.currentSessionPos++;
                this.qIdx = this.currentSessionPos;
                this.renderQuestion();
            }
        }, 1200);
    },

    renderQuestion: function() {
        const q = this.session[this.currentSessionPos];

        document.getElementById('q-seq').innerText = this.currentSessionPos + 1;
        document.getElementById('q-id').innerText = q.id;
        document.getElementById('q-text').innerText = q.text;

        const container = document.getElementById('options-container');
        container.innerHTML = '';

        q.options.forEach((opt, idx) => {
            const el = document.createElement('div');
            let css = "option-card w-full p-4 rounded-xl border border-slate-200 cursor-pointer flex gap-3 items-start bg-white";

            if (q.userAnswer === idx) css += " selected";

            if (q.checked) {
                css += " disabled";
                if (opt.isCorrect) css += " correct";
                else if (q.userAnswer === idx) css += " wrong";
            }

            el.className = css;

            if (!q.checked) {
                el.onclick = () => this.handleOptionSelect(idx);
            }

            const letter = String.fromCharCode(65 + idx);
            el.innerHTML = `
                <div class="font-bold text-slate-500 mt-0.5 w-6 shrink-0">${letter}.</div>
                <div class="text-slate-700 text-sm leading-relaxed grow">${opt.text}</div>
                ${q.checked && opt.isCorrect ? '<span class="material-symbols-outlined text-green-600">check_circle</span>' : ''}
                ${q.checked && !opt.isCorrect && q.userAnswer === idx ? '<span class="material-symbols-outlined text-red-500">cancel</span>' : ''}
            `;
            container.appendChild(el);
        });

        // Progress
        const pct = ((this.currentSessionPos + 1) / this.session.length) * 100;
        document.getElementById('progress-bar').style.width = `${pct}%`;

        // Explanation
        const expEl = document.getElementById('explanation-area');
        if(this.mode === 'practice' && q.checked) {
            expEl.classList.remove('hidden');
            const correctIdx = q.options.findIndex(o => o.isCorrect);
            document.getElementById('exp-correct-char').innerText = String.fromCharCode(65 + correctIdx);
            document.getElementById('exp-text').innerText = q.explanation;
        } else {
            expEl.classList.add('hidden');
        }

        this.updateControls(q);
    },

    updateControls: function(q) {
        const btnPrev = document.getElementById('btn-prev');
        const btnCheck = document.getElementById('btn-check');
        const btnNext = document.getElementById('btn-next');

        btnPrev.disabled = (this.currentSessionPos === 0);
        const isLast = (this.currentSessionPos === this.session.length - 1);
        const answered = q.userAnswer !== null;
        const awaitingAck = this.awaitingWrongContinue && this.lastAnsweredIndex === this.currentSessionPos;

        if(this.mode === 'practice') {
            btnCheck.classList.add('hidden');
            if(answered) {
                btnNext.classList.remove('hidden');
                if(isLast) {
                    btnNext.innerHTML = `<span>${awaitingAck ? '확인 후 결과' : '결과 보기'}</span> <span class="material-symbols-outlined text-sm">${awaitingAck ? 'task_alt' : 'flag'}</span>`;
                    btnNext.onclick = () => awaitingAck ? this.handlePracticeContinue() : this.showMidSummary();
                } else {
                    btnNext.innerHTML = `<span>${awaitingAck ? '확인 후 다음' : '다음'}</span> <span class="material-symbols-outlined text-sm">arrow_forward</span>`;
                    btnNext.onclick = () => awaitingAck ? this.handlePracticeContinue() : this.nextQuestion();
                }
            } else {
                btnNext.classList.add('hidden');
                btnCheck.classList.add('hidden');
            }
        } else if(this.mode === 'exam') {
            btnCheck.classList.add('hidden');
            btnNext.classList.remove('hidden');
            if(isLast) {
                btnNext.innerHTML = `<span>제출하기</span> <span class="material-symbols-outlined text-sm">flag</span>`;
                btnNext.onclick = () => this.finishExam();
            } else {
                btnNext.innerHTML = `<span>다음</span> <span class="material-symbols-outlined text-sm">arrow_forward</span>`;
                btnNext.onclick = () => this.nextQuestion();
            }
        }
    },

    prevQuestion: function() {
        this.pendingWrongAckId = null;
        if(this.currentSessionPos > 0) {
            this.currentSessionPos--;
            this.qIdx = this.currentSessionPos;
            this.renderQuestion();
        }
    },

    nextQuestion: function() {
        this.awaitingWrongContinue = false;
        this.pendingWrongAckId = null;
        if(this.autoAdvanceTimer) clearTimeout(this.autoAdvanceTimer);
        if(this.currentSessionPos < this.session.length - 1) {
            this.currentSessionPos++;
            this.qIdx = this.currentSessionPos;
            this.renderQuestion();
        }
    },

    startPractice: function() {
        this.mode = 'practice';
        this.currentIndex = 0;
        this.totalSeen = 0;
        this.seenQuestions = new Set();
        this.awaitingWrongContinue = false;
        this.lastAnsweredIndex = null;
        this.weakQueue = [];
        this.batchWrongIds = [];
        this.pendingWrongAckId = null;
        this.lastSummaryData = null;
        this.db.forEach(q => {
            if(!q.meta) q.meta = {};
            q.meta.correct_count = 0;
            q.meta.wrong_count = 0;
            q.meta.mastered = false;
        });
        this.setView('view-quiz');
        this.loadBatch();
        this.updateStatus("Practice", "Batch");
    },

    setSummaryState: function(isComplete = false) {
        const iconEl = document.getElementById('summary-icon');
        const titleEl = document.getElementById('summary-title');
        const detailEl = document.getElementById('summary-detail');
        const primaryBtn = document.getElementById('summary-primary');
        const homeBtn = document.getElementById('summary-home');
        const statsBox = document.getElementById('summary-stats');
        const progressBox = document.getElementById('summary-progress-wrap');

        if(isComplete) {
            iconEl.className = "w-16 h-16 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4";
            iconEl.innerHTML = `<span class="material-symbols-outlined text-3xl">task_alt</span>`;
            titleEl.innerText = "모든 문제를 마쳤습니다";
            detailEl.innerHTML = "남은 문제가 없습니다.<br><span class=\"text-xs text-slate-400\">아래에서 마지막 세트 요약을 확인하고 홈으로 돌아가 새 연습을 시작하세요.</span>";

            primaryBtn.innerText = "홈으로";
            primaryBtn.onclick = () => this.goHome();
            homeBtn.classList.add('hidden');
            statsBox.classList.remove('hidden');
            progressBox.classList.remove('hidden');
        } else {
            iconEl.className = "w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4";
            iconEl.innerHTML = `<span class="material-symbols-outlined text-3xl">refresh</span>`;
            titleEl.innerText = "세트 완료";
            detailEl.innerHTML = `이번 세트 오답: <span id="summary-wrong-count" class="font-bold text-red-500">0</span>개<br><span class=\"text-xs text-slate-400\">틀린 문제는 다음 세트에 자동으로 포함됩니다.</span>`;

            primaryBtn.innerText = "다음 세트 시작";
            primaryBtn.onclick = () => this.nextBatch();
            homeBtn.classList.add('hidden');
            statsBox.classList.remove('hidden');
            progressBox.classList.remove('hidden');
        }
    },

    renderSummaryStats: function(data) {
        document.getElementById('summary-wrong-count').innerText = data.wrongCount;
        document.getElementById('summary-accuracy').innerText = `${data.correct}/${data.total} (${data.accuracy}%)`;
        document.getElementById('summary-correct').innerText = data.correct;
        document.getElementById('summary-wrong').innerText = data.wrong;
        document.getElementById('summary-progress-text').innerText = `전체 진행 ${data.seen}/${data.totalQuestions} (${data.progress}%)`;
        document.getElementById('summary-progress-bar').style.width = `${data.progress}%`;
    },

    loadBatch: function() {
        const built = this.buildSessionQuestions();

        if(!built) {
            this.setSummaryState(true);
            if(this.lastSummaryData) this.renderSummaryStats(this.lastSummaryData);
            this.setView('view-summary');
            return false;
        }

        this.batchWrongIds = [];
        this.pendingWrongAckId = null;
        this.awaitingWrongContinue = false;
        this.session = this.currentSession.map(idx => this.prepareQuestion(this.db[idx], idx));

        this.currentSessionPos = 0;
        this.qIdx = 0;
        this.renderQuestion();
        return true;
    },

    finishBatch: function() {
        this.showMidSummary();
    },

    nextBatch: function() {
        if(this.autoAdvanceTimer) clearTimeout(this.autoAdvanceTimer);
        this.pendingWrongAckId = null;
        this.awaitingWrongContinue = false;
        const loaded = this.loadBatch();
        if(loaded) {
            this.setView('view-quiz');
        }
    },

    advanceToNextQuestion: function() {
        this.currentSessionPos++;
        this.qIdx = this.currentSessionPos;

        if(this.currentSessionPos >= this.session.length) {
            this.showMidSummary();
            return;
        }

        this.renderQuestion();
    },

    handlePracticeContinue: function() {
        if(!this.awaitingWrongContinue) return;
        this.awaitingWrongContinue = false;
        this.pendingWrongAckId = null;
        this.advanceToNextQuestion();
    },

    showMidSummary: function() {
        if(this.autoAdvanceTimer) clearTimeout(this.autoAdvanceTimer);
        const uniqueWrongs = [...new Set(this.batchWrongIds)];
        this.setSummaryState(false);

        const total = this.session.length;
        let correct = 0;
        let wrong = 0;

        const tableBody = document.getElementById('summary-table-body');
        tableBody.innerHTML = '';

        const wrongSet = new Set(uniqueWrongs);
        const wrongRows = this.session.filter(q => wrongSet.has(q.sourceIndex));

        this.session.forEach((q) => {
            const answered = q.userAnswer !== null;
            const isCorrect = answered && q.options[q.userAnswer].isCorrect;
            if(isCorrect) correct++;
            else wrong++;
        });

        if(wrongRows.length === 0) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td colspan="3" class="py-6 text-center text-base sm:text-lg text-slate-500">이번 세트에서 틀린 문제가 없습니다. 계속 진행해볼까요?</td>
            `;
            tableBody.appendChild(row);
        } else {
            wrongRows.forEach((q, idx) => {
                const answered = q.userAnswer !== null;
                const correctIdx = q.options.findIndex(o => o.isCorrect);
                const correctOpt = correctIdx >= 0 ? q.options[correctIdx] : null;
                const userLabel = answered ? String.fromCharCode(65 + q.userAnswer) : '미응답';
                const correctLabel = correctOpt ? String.fromCharCode(65 + correctIdx) : '-';
                const userText = answered && q.options[q.userAnswer] ? this.trimText(q.options[q.userAnswer].text, 120) : '';
                const correctText = correctOpt ? this.trimText(correctOpt.text, 120) : '';
                const explanation = this.trimText(q.explanation || '해설 없음', 220);

                const row = document.createElement('tr');
                row.className = 'align-top';
                row.innerHTML = `
                    <td class="py-5 pr-4">
                        <div class="text-sm sm:text-base font-semibold text-red-600 flex items-center gap-2">
                            <span class="material-symbols-outlined text-base">report</span>
                            Q${idx + 1} · ID ${q.id}
                        </div>
                        <div class="text-base sm:text-lg text-slate-800 leading-snug mt-2">${this.trimText(q.text, 200)}</div>
                        <div class="text-sm sm:text-base text-slate-600 mt-2">선택: ${userLabel}${userText ? ' · ' + userText : ''}</div>
                    </td>
                    <td class="py-5 px-4">
                        <div class="text-base sm:text-lg font-semibold text-slate-800">${correctLabel}</div>
                        <div class="text-sm sm:text-base text-slate-600">${correctText}</div>
                    </td>
                    <td class="py-5 pl-4 text-sm sm:text-base text-slate-700 whitespace-pre-line leading-relaxed">${explanation}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        const accuracy = total ? Math.round((correct / total) * 100) : 0;
        const totalQuestions = this.db.length;
        const seen = Math.min(this.totalSeen, totalQuestions);
        const progress = totalQuestions ? Math.round((seen / totalQuestions) * 100) : 0;

        const summaryData = {
            correct,
            wrong,
            total,
            accuracy,
            wrongCount: uniqueWrongs.length,
            seen,
            totalQuestions,
            progress
        };

        this.renderSummaryStats(summaryData);
        this.lastSummaryData = summaryData;

        this.setView('view-summary');
    },

    startExam: function() {
        if(this.autoAdvanceTimer) clearTimeout(this.autoAdvanceTimer);
        this.pendingWrongAckId = null;
        this.awaitingWrongContinue = false;
        this.mode = 'exam';
        this.setView('view-quiz');
        const pool = this.shuffle([...this.db]);
        const selected = pool.slice(0, 60);
        this.session = selected.map(raw => this.prepareQuestion(raw, raw.sourceIndex ?? null));
        this.currentSession = this.session.map((_, idx) => idx);
        this.currentSessionPos = 0;
        this.qIdx = 0;
        this.startTimer();
        this.renderQuestion();
    },

    startTimer: function() {
        this.timeLeft = 120 * 60;
        if(this.timer) clearInterval(this.timer);
        this.updateTimerDisplay();
        this.timer = setInterval(() => {
            this.timeLeft--;
            this.updateTimerDisplay();
            if(this.timeLeft <= 0) this.finishExam();
        }, 1000);
    },

    updateTimerDisplay: function() {
        const m = Math.floor(this.timeLeft / 60).toString().padStart(2,'0');
        const s = (this.timeLeft % 60).toString().padStart(2,'0');
        this.updateStatus("Time Left", `${m}:${s}`);
    },

    finishExam: function() {
        clearInterval(this.timer);
        
        let correct = 0;
        this.session.forEach(q => {
            if(q.userAnswer !== null && q.options[q.userAnswer].isCorrect) correct++;
        });

        const score = Math.round((correct / this.session.length) * 100);
        
        document.getElementById('res-score').innerText = score;
        document.getElementById('res-correct').innerText = correct;
        document.getElementById('res-wrong').innerText = this.session.length - correct;
        document.getElementById('res-total').innerText = this.session.length;

        const iconEl = document.getElementById('res-icon');
        if(score >= 70) {
            iconEl.innerHTML = `<span class="material-symbols-outlined text-6xl text-green-500">emoji_events</span>`;
            document.getElementById('res-score').className = "text-6xl font-black text-green-600";
        } else {
            iconEl.innerHTML = `<span class="material-symbols-outlined text-6xl text-slate-400">sentiment_dissatisfied</span>`;
            document.getElementById('res-score').className = "text-6xl font-black text-slate-700";
        }

        document.getElementById('btn-review').classList.remove('hidden');
        this.setView('view-result');
    },

    reviewMode: function() {
        const wrongs = this.session.filter(q => {
            if(q.userAnswer === null) return true;
            return !q.options[q.userAnswer].isCorrect;
        });

        if(wrongs.length === 0) return alert("틀린 문제가 없습니다.");

        this.mode = 'practice';
        this.session = wrongs;
        this.session.forEach(q => q.checked = true);
        this.currentSession = this.session.map((_, idx) => idx);
        this.currentSessionPos = 0;
        this.qIdx = 0;
        this.setView('view-quiz');
        this.renderQuestion();
        this.updateStatus("Review", "Wrongs");
    },

    setView: function(id) {
        ['view-start', 'view-quiz', 'view-summary', 'view-result'].forEach(v => {
            const el = document.getElementById(v);
            if(v === id) {
                el.classList.remove('hidden');
                el.classList.add('flex');
            } else {
                el.classList.add('hidden');
                el.classList.remove('flex');
            }
        });
    },

    updateStatus: function(label, value) {
        document.getElementById('status-display').classList.remove('hidden');
        document.getElementById('status-label').innerText = label;
        document.getElementById('status-value').innerText = value;
    }
};

window.app = app;
window.addEventListener('load', () => {
    app.init();
    document.addEventListener('keydown', (e) => {
        if(app.mode === 'practice' && app.awaitingWrongContinue) {
            e.preventDefault();
            app.handlePracticeContinue();
        }
    });
});
</script>

</body></html>
